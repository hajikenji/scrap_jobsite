# 自己責任でお願いします
Ruby 3.0.1
## 説明
「マイ○ビ転職サイトの新規求人分だけサイトから取ってくる」アプリです。  
転職サイトとかで求人を探す事があると思いますが、  
求人数が数百件以上も企業があると「再度」探しに行くのがしんどいと思います。  
「良い求人更新されてないかな」と見に行ってもよくあるSES企業ばかり、前見た企業ばかりで探すのが大変だったり、  
**目当てだけ探すのはしんどい時もあるかもしれません。**  
それを解決したいアプリです。

#### 使用の簡単な流れ
1. 「勤務地は東京か札幌」など検索条件を決める
2. アプリを起動する
3. Googleスプレッドシートに条件にあった求人が載る
4. 数週間後など、再度アプリを起動する（検索条件は変えてもOK）
5. 前回までにスプシに載っていた企業を除いて、条件にあった求人が載る
6. 以下繰り返し
## 初期設定
1時間は要すると覚悟しておいてください。
```
git clone
cd scrap_jobsite
bundle install
```

### 1. googleのAPIを取得する必要があります。  
https://techblog.gmo-ap.jp/2018/12/04/ruby_google_sheets_drive/.  
上記のサイトを参考にして 2-2. 初回の認証 までを行なって下さい（その後は情報が古いためおそらく出来ない）.  
代わりに、  
https://qiita.com/nobuo_hirai/items/54b142a6e6499173f4ed.  
上記のサイトの「credentials.jsonファイルをダウンロードします。」らへんの項目を参考にして、（ページ内検索でcredentialsを入れると早く見つかります）.  
Google APIの「クライアントID」と「クライアントシークレット」 のJSONをダウンロードしてください。  
そのJSONをVScodeか何かで開いて、中身をコピーします。  
そしてgit cloneした scrap_jobsite内に「credentials.jsonファイル」を新規作成して下さい。  
そのcredentials.jsonに先ほどコピーした内容を貼り付ければAPI設定は完了です。  

### 2. 何か自由に使えるスプレッドシートをまず用意してください。  
用意できたらそのシートをブラウザで開いて、URLの一部をコピーします。  
```
https://docs.google.com/spreadsheets/d/xxxxxxxxxxxxxxxxxxxxxxxxxxxx/edit#gid=0
# xxxxxxxxxxxxxxの部分だけコピーする
```
次に、.envファイルを作成して、中身を下記のようにします。
```
SHEET_ID=xxxxxxxxxxxxxxxxxxx
```
これで完了です。特定のスプレッドシートに書き込めるようになりました。

### 3.一旦起動させます。  
https://qiita.com/nobuo_hirai/items/54b142a6e6499173f4ed.  
上記のサイトの「初回実行時はURLが表示されるのでそれにアクセスします。」らへんの項目を参考にして、  
irbなどで
```
require "mynavi_update.rbのパス"
# 例：require "User/xxxx/xxx/......./mynavi_update.rb"
```
をすると、数秒後にターミナルが止まります。表示されたURLを開いて、問題なければ許可を押してください。  
その後若干の作業の後、アプリが問題なく動いてスプレッドシートが更新されていれば初期設定は終了です。  

## 使い方
mynavi_update.rb の検索条件のコメントアウトの付け外しで、検索条件を設定できます。  
初期状態はテスト用仕様で特殊なので、好きな設定に変えましょう。
その後はirbなどで require "mynavi_update.rbのパス" で毎度起動します。  

#### 使用上の注意
1. スリープまでの時間を20分以上などに変更して下さい。  
検索条件によってはスクレイピングの時間が長いです。PCがスリープ状態（macだと画面が暗くなる状態）になると接続が切れてエラーになるので、  
時間を長くすることをおすすめします。
2. スプレッドシートに書き込まれた企業名はなるべく消さないで下さい。  
大手SESなど不要と思った企業をシートから消さないで下さい。また書き込まれます。  
「スプシにすでにある企業を再度スプシに書き込まない」というアルゴリズムのためです。  
不要と思った企業はスプシのG行などに「不要」、「高中低でランク付け（こうするとスプシ内で並べ替えもできる）」などと記載したり、  
必要な企業だけ別シートにコピペしたり、背景色をブラックにするなどで実質的に除外するようにしてください。
3. スクレイピング中にネットが切断されるとエラーになります。
